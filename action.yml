name: "uncover-tests"
description: "Filter out Rust test functions and modules from LCOV coverage reports."
author: "Eric Scouten"
branding:
  icon: "filter"
  color: "purple"

inputs:
  input-file:
    description: "Path to LCOV file generated by cargo llvm-cov."
    default: "lcov.info"
    required: false
  output-file:
    description: "Path to write filtered LCOV output."
    default: "lcov.filtered.info"
    required: false
  delete-unfiltered:
    description: "Whether to delete the unfiltered LCOV file after filtering (recommended to avoid Codecov merging both reports)."
    default: "true"
    required: false

runs:
  using: "composite"
  steps:
    - name: Filter Rust tests from coverage
      shell: bash
      run: |
        echo "ðŸ”§ Running uncover-tests..."
        args=""
        if [[ "${{ inputs.delete-unfiltered }}" == "true" ]]; then
          args="--delete-unfiltered"
        fi

        python3 "${{ github.action_path }}/filter_lcov.py" \
          --input "${{ inputs.input-file }}" \
          --output "${{ inputs.output-file }}" \
          $args
